<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1f2937">
    <title>What's On?</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="manifest" href="/manifest.json">
    <style>
        body { 
            -webkit-tap-highlight-color: transparent;
            background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
            min-height: 100vh;
        }
        .service-badge {
            font-size: 0.65rem;
            padding: 0.2rem 0.5rem;
        }
        .show-card {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .show-card:active {
            transform: scale(0.98);
        }
    </style>
</head>
<body class="text-gray-100 p-4 pb-20">
    <header class="mb-6">
        <h1 class="text-2xl font-bold text-white">üì∫ What's On?</h1>
        <p class="text-gray-400 text-sm">{{ tonight|length + catching_up|length }} shows tracked</p>
    </header>

    {% if tonight %}
    <section class="mb-8">
        <h2 class="text-lg font-semibold text-emerald-400 mb-3 flex items-center gap-2">
            <span>üü¢</span> Ready to Watch
        </h2>
        <div class="space-y-3">
            {% for show in tonight %}
            <div class="show-card rounded-xl p-4 transition-transform">
                <div class="flex justify-between items-start">
                    <div class="flex-1">
                        <h3 class="font-semibold text-white text-lg">{{ show.title }}</h3>
                        <div class="flex items-center gap-2 mt-1">
                            <span class="service-badge rounded-full 
                                {% if show.service == 'Max' %}bg-blue-600
                                {% elif show.service == 'Apple TV+' %}bg-gray-600
                                {% elif show.service == 'Hulu' %}bg-green-600
                                {% elif show.service == 'Peacock' %}bg-yellow-600 text-black
                                {% elif show.service == 'Paramount+' %}bg-blue-800
                                {% elif show.service == 'Prime Video' %}bg-cyan-700
                                {% else %}bg-purple-600{% endif %}
                                text-white font-medium">
                                {{ show.service }}
                            </span>
                            {% if show.air_day %}
                            <span class="text-gray-400 text-xs">{{ show.air_day }}s</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="text-right">
                        {% if show.current_episode == 99 %}
                        <span class="text-emerald-400 text-sm">‚úì Current</span>
                        {% else %}
                        <span class="text-gray-300 text-sm">S{{ show.current_season }}E{{ show.current_episode }}</span>
                        {% endif %}
                    </div>
                </div>
                {% if show.notes %}
                <p class="text-gray-400 text-xs mt-2">{{ show.notes }}</p>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    {% if catching_up %}
    <section class="mb-8">
        <h2 class="text-lg font-semibold text-amber-400 mb-3 flex items-center gap-2">
            <span>‚è≥</span> Catching Up
        </h2>
        <div class="space-y-3">
            {% for show in catching_up %}
            <div class="show-card rounded-xl p-4 transition-transform">
                <div class="flex justify-between items-start">
                    <div class="flex-1">
                        <h3 class="font-semibold text-white text-lg">{{ show.title }}</h3>
                        <div class="flex items-center gap-2 mt-1">
                            <span class="service-badge rounded-full 
                                {% if show.service == 'Max' %}bg-blue-600
                                {% elif show.service == 'Apple TV+' %}bg-gray-600
                                {% elif show.service == 'Hulu' %}bg-green-600
                                {% elif show.service == 'Peacock' %}bg-yellow-600 text-black
                                {% elif show.service == 'Paramount+' %}bg-blue-800
                                {% elif show.service == 'Prime Video' %}bg-cyan-700
                                {% else %}bg-purple-600{% endif %}
                                text-white font-medium">
                                {{ show.service }}
                            </span>
                            {% if show.air_day %}
                            <span class="text-gray-400 text-xs">{{ show.air_day }}</span>
                            {% endif %}
                        </div>
                    </div>
                    <div class="text-right">
                        <span class="text-amber-300 font-medium">S{{ show.current_season }}E{{ show.current_episode }}</span>
                        <form action="/next-episode/{{ show.id }}" method="POST" class="inline ml-2">
                            <button type="submit" class="bg-gray-700 hover:bg-gray-600 text-white text-xs px-2 py-1 rounded">
                                +1
                            </button>
                        </form>
                    </div>
                </div>
                {% if show.notes %}
                <p class="text-gray-400 text-xs mt-2">{{ show.notes }}</p>
                {% endif %}
                <div class="mt-3">
                    <form action="/mark-caught-up/{{ show.id }}" method="POST" class="inline">
                        <button type="submit" class="text-emerald-400 text-xs hover:underline">
                            Mark caught up ‚úì
                        </button>
                    </form>
                </div>
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}

    <footer class="fixed bottom-0 left-0 right-0 bg-gray-900/95 backdrop-blur border-t border-gray-800 p-3">
        <p class="text-center text-gray-500 text-xs">
            Tell Henry what you watched ü¶â
        </p>
    </footer>
</body>
</html>
